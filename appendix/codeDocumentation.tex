\chapter{Code Documentation}

The code documentation lists the JavaScript objects in bold, followed by a list of their methods.

\clearpage 

\section{Models - Backbone Models}

\subsection*{Building}
	defaults - Default values for this object

	timeSinceRevenue - Duration since last time the building generated revenue.

	shouldBeRemoved - Returns true if the durability of this building is <= 0.

	updateRevenue - Makes this building generate revenue.

	lowerDurability - Lower the durability of this building.

	render - Draw this object to a canvas context.

	update - Update the state of this building.

\subsection*{Entity}

	initialize - Initialize a PowerLineList for this entity.

	update - Update the state of this entity. Should be overwritten by subclasses.

	getCenterPos - returns the center position of this entity.

	shouldBeRemoved - Returns if this entity should be removed from the map or not. Should be overwritten by subclasses.

	connectTo - Connect this entity to a PowerLine.

	disconnect - Disconnect this entity from a PowerLine.

	contains - Check if a point is inside of this entity.

\subsection*{Highscore}

	updateTime - Updates this high score object if the new score is smaller than the old score.

	saveData - Write data to local storage.

	toString - Returns a string representation of this object.

\subsection*{Level}
	
	defaults - Default values for this object.

	initialize - Initialize and shuffle the list of possible building positions for this level.

	update - Update the state of the level.

	createBuilding - Create a new building and place it on the map.

	tapMap - Process user input.

	buildPowerPlantAt - Build a new Powerplant on the map.

	costOfPowerLine - Calculate the cost of a Powerline.

	costOfFixingPowerLine - Calculate the cost of repairing a Powerline.

	connectWithPowerLine - Connect two buildings with a Powerline.

	fixPowerLine - Repair a Powerline.

\subsection*{Map}

	defaults - Default values for map.

	update - Update the state of the game map.

	translateView - Move the view of the map.

	getBuildingAt - Returns the building located here on the map. Input coordinates in screen space.

	getBuildingAtMap - Returns the building located here on the map. Input coordinates in world space.

	screenToMapCoordinates - Translate coordinates from screen space to map space.

	getPowerLineAt - Return the powerline located here on the map. Input coordinates in screen space.

\subsection*{Player}

	defaults - Player default values.

	damage - Inflict damage to the players health.

\subsection*{Powerline}

	defaults - Powerline default values.

	isHealthy - Returns if this Powerline is healthy or not.

	getPointA - Returns the center position of the first building this Powerline is connected to.

	getPointB - Returns the center position of the second building this Powerline is connected to.

	removeFrom - Remove this Powerline from the map and disconnect everything connected to it.

	break - Set the state of this Powerline to broken.

	fix - Set the state of this Powerline to healthy.

	render - Draw this Powerline to the canvas context.

\subsection*{Powerplant}

	defaults - Default values for this Powerplant.

	canBeUpgraded - Returns true if this Powerplant can be upgraded.

	getMaxPower - Returns how much power this powerplant can output.

	upgrade - Upgrade this Powerplant.

	distributePower - Distribute power from this Powerplant to as many connected buildings as allowed by getMaxPower using Breadth First Search.

	render - Draw this Powerplant to the canvas context.

\clearpage

\section{Presenters - Backbone Views}

\subsection*{HighscoreView}
	initialize - Render the highscore list and begin listening to changes to the list.
	
	render - Update the HTML Object with the state of the highscore list.

\subsection*{HpBar}
	init - Render the player's health and begin listening to changes to player health.

	render - Draw the player's health to the HP bar canvas.

\subsection*{HudMoney}
	init - Render the player's money and begin listening to changes to the player's money.

	render - Update the HTML Object with the state of the player's health.

\subsection*{HudButtons}

	events - Which events this Presenter should receive from the HTML Object.

	buildPowerPlant - Change the game state to BuildPP.

	buildPowerLine - Change the game state to BuildPL.

	togglePause - Change the game's pause state.

\subsection*{Menu}

	events - Which events this Presenter should receive from the HTML Object.

	startGame - Start the game.

	instructions - Go to the instruction screen.

	highscore - Go to the highscore screen.

\subsection*{Screen}

	init - Begin listening to changes to the state of the game map.

	iOS - Detect if the application is running on iOS.

	needsRepaint - Set to true if the map has to be redrawn.

	prevZoomed - Set to true if the map was "zoomed in" during last render.

	resetZoom - Resets the scaling of the HTML canvas.

	render - Draw the map state onto the HTML canvas.

	renderBuildings - Draw buildings to the HTML canvas.

	renderBuildingTemp - Draw a circle below the building selected to build a powerline from.

	renderBuildMode - Draw indicators that the game is in build mode.

	renderPowerLines - Draw the powerlines to the HTML canvas.

	buildingTemp: null,

  	screenMove: false,

  	prevTouchStart: null,

 	prevTouchEnd: null,

  	prevTouchEndTime: -Infinity,

  	touchStart

  	touchEnd

  	touchMove

  	doubleTap

  	handleEvent

\subsection*{HeaderTimer}

	init

	render

\subsection*{HeaderLevel}

	init

	render

\clearpage

\section{Collections - Backbone Collections}
	
\subsection*{BuildingList}

	model: Entity

\subsection*{HigscoreList}
	
	model: Highscore

	initialize

	loadData

	saveData

	addScore

	writeToConsole

\subsection*{PowerLineList}

	model: PowerLine

	sample

\clearpage

\section{Singletons}

\subsection*{App}

	gameLevel: null,
  	highscoreList: null,
  	gameScreen: null
  	timer: null,
  	level: null,
  	hudBtns: null,
  	hudMny: null,
  	hpBar: null,
  	mainMenu: null,
  	highscoreView: null,
  	gameRunning: false,

  	initialize

  	initGame

  	startGame

  	stopGame

  	onDeviceReady

\subsection*{AudioPlayer}

	mediaSuccess

	mediaError

	getMediaStatusString

	mediaStatus

	getMediaPath

	audioPlayer (init, loadSfx, loadBGM, playBGM, stopBGM, playRandMoney, stopAll)

\subsection*{ImageLibrary}
	
	var imagesLoaded=0;
	var imagesToLoad=1;

	imgLib (isAllImagesLoaded, loadImage)	

\clearpage

\section{Other}

\subsection*{Utilities}

	requestAnimFrame

	getPhoneGapPath

	timeToString

	onBackButton

	scrollToTop

	calcGoal

	calcLevelSize

	generateBuildingSpawnTime

	sqr

	dist2

	distToSegmentSquared(p, v, w)

	distToSegment


\subsection*{Constants}
	
	GAME\_FPS

	DEBUG

	HUD\_HEIGHT

	BuildingTemplates

	BUILDING\_WIDTH

	BUILDING\_REVENUE\_FREQ

	BUILDING\_DURABILITY

	POWERPLANT\_COST

	POWERPLANT\_MAX\_LEVEL

	POWERPLANT\_POWER

	UPGRADE\_COST

	POWERLINE\_COST

	POWERLINE\_WIDTH

	GameState

	PowerLineState

	PLAYER\_MAX\_HP

	PLAYER\_START\_MONEY
