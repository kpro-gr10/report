\chapter{Code Documentation}

The code documentation lists the JavaScript objects in bold, followed by a list of their methods.

\clearpage 

\section{Models - Backbone Models}

\subsection*{Building}
	defaults - Default values for this object

	timeSinceRevenue - Duration since last time the building generated revenue.

	shouldBeRemoved - Returns true if the durability of this building is <= 0.

	updateRevenue - Makes this building generate revenue.

	lowerDurability - Lower the durability of this building.

	render - Draw this object to a canvas context.

	update - Update the state of this building.

\subsection*{Entity}

	initialize - Initialize a PowerLineList for this entity.

	update - Update the state of this entity. Should be overwritten by subclasses.

	getCenterPos - returns the center position of this entity.

	shouldBeRemoved - Returns if this entity should be removed from the map or not. Should be overwritten by subclasses.

	connectTo - Connect this entity to a PowerLine.

	disconnect - Disconnect this entity from a PowerLine.

	contains - Check if a point is inside of this entity.

\subsection*{Highscore}

	updateTime - Updates this high score object if the new score is smaller than the old score.

	saveData - Write data to local storage.

	toString - Returns a string representation of this object.

\subsection*{Level}
	
	defaults - Default values for this object.

	initialize - Initialize and shuffle the list of possible building positions for this level.

	update - Update the state of the level.

	createBuilding - Create a new building and place it on the map.

	tapMap - Process user input.

	buildPowerPlantAt - Build a new Powerplant on the map.

	costOfPowerLine - Calculate the cost of a Powerline.

	costOfFixingPowerLine - Calculate the cost of repairing a Powerline.

	connectWithPowerLine - Connect two buildings with a Powerline.

	fixPowerLine - Repair a Powerline.

\subsection*{Map}

	defaults - Default values for map.

	update - Update the state of the game map.

	translateView - Move the view of the map.

	getBuildingAt - Returns the building located here on the map. Input coordinates in screen space.

	getBuildingAtMap - Returns the building located here on the map. Input coordinates in world space.

	screenToMapCoordinates - Translate coordinates from screen space to map space.

	getPowerLineAt - Return the powerline located here on the map. Input coordinates in screen space.

\subsection*{Player}

	defaults - Player default values.

	damage - Inflict damage to the players health.

\subsection*{Powerline}

	defaults - Powerline default values.

	isHealthy - Returns if this Powerline is healthy or not.

	getPointA - Returns the center position of the first building this Powerline is connected to.

	getPointB - Returns the center position of the second building this Powerline is connected to.

	removeFrom - Remove this Powerline from the map and disconnect everything connected to it.

	break - Set the state of this Powerline to broken.

	fix - Set the state of this Powerline to healthy.

	render - Draw this Powerline to the canvas context.

\subsection*{Powerplant}

	defaults - Default values for this Powerplant.

	canBeUpgraded - Returns true if this Powerplant can be upgraded.

	getMaxPower - Returns how much power this powerplant can output.

	upgrade - Upgrade this Powerplant.

	distributePower - Distribute power from this Powerplant to as many connected buildings as allowed by getMaxPower using Breadth First Search.

	render - Draw this Powerplant to the canvas context.

\clearpage

\section{Presenters - Backbone Views}

\subsection*{HighscoreView}
	initialize - Render the highscore list and begin listening to changes to the list.
	
	render - Update the HTML with the state of the highscore list.

\subsection*{HpBar}
	init - Render the player's health and begin listening to changes to player health.

	render - Draw the player's health to the HP bar canvas.

\subsection*{HudMoney}
	init - Render the player's money and begin listening to changes to the player's money.

	render - Update the HTML with the state of the player's health.

\subsection*{HudButtons}

	events - Which events this Presenter should receive from the HTML.

	buildPowerPlant - Change the game state to BuildPP.

	buildPowerLine - Change the game state to BuildPL.

	togglePause - Change the game's pause state.

\subsection*{Menu}

	events - Which events this Presenter should receive from the HTML.

	startGame - Start the game.

	instructions - Go to the instruction screen.

	highscore - Go to the highscore screen.

\subsection*{Screen}

	init - Begin listening to changes to the state of the game map.

	iOS - Detect if the application is running on iOS.

	needsRepaint - Set to true if the map has to be redrawn.

	prevZoomed - Set to true if the map was "zoomed in" during last render.

	resetZoom - Resets the scaling of the HTML canvas.

	render - Draw the map state onto the HTML canvas.

	renderBuildings - Draw buildings to the HTML canvas.

	renderBuildingTemp - Draw a circle below the building selected to build a powerline from.

	renderBuildMode - Draw indicators that the game is in build mode.

	renderPowerLines - Draw the powerlines to the HTML canvas.

	buildingTemp - Holds the building that you are currently building a powerline from.

  	screenMove - Set to true if the current series of touch events has a touch move event.

  	prevTouchStart - Previous touch start event.

 	prevTouchEnd - Previous touch end event.

  	prevTouchEndTime - Time of previous touch end event.

  	touchStart - Called when a touch start event is registered.

  	touchEnd - Called when a touch end event is registered.

  	touchMove - Called when a touch move event is registered.

  	doubleTap - Called when the player double taps the screen.

  	handleEvent - Called when this screen receives an input event.

\subsection*{HeaderTimer}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	init & Render the current playtime and begin listening to the level's playtime variable. \\ \hline
	render & Update the HTML with the state of the level's playtime variable. \\ \hline
	\end{tabular}
	\end{table}

\subsection*{HeaderLevel}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	init & Render the current level and begin listening to changes to the level. \\ \hline
	render & Update the HTML with the level.  \\ \hline
	\end{tabular}
	\end{table}

\clearpage

\section{Collections - Backbone Collections}
	
\subsection*{BuildingList}

	model: Entity

\subsection*{HigscoreList}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	initialize & Load highscore data. \\ \hline
	loadData & Read highscore data from local storage. \\ \hline
	saveData & Save highscore data to local storage. \\ \hline
	addScore & If the new score is better than the old, update the level's highscore. \\ \hline
	writeToConsole & Write the highscore list to console for debug purposes. \\ \hline

	\end{tabular}
	\end{table}

	
	model: Highscore

	

\subsection*{PowerLineList}

	model: PowerLine

	sample

\clearpage

\section{Singletons}

\subsection*{App}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Variables & Description \\ \hline
	gameLevel & Current level model. \\ \hline
  	highscoreList & List of highscores. \\ \hline
  	gameScreen & Screen presenter. \\ \hline
  	timer & Timer presenter. \\ \hline
  	level & Level presenter. \\ \hline
  	hudBtns & Hud Buttons presenter. \\ \hline
  	hudMny & Hud Player Money presenter. \\ \hline
  	hpBar & Player Health presenter. \\ \hline
  	mainMenu & Main menu presenter. \\ \hline
  	highscoreView & Highscore presenter. \\ \hline
  	gameRunning & True if the game loop is running. \\ \hline
	
	\end{tabular}
	\end{table}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	initialize & Initialize this object's data. \\ \hline
  	initGame & Init a new game. \\ \hline
  	startGame & Start the game. \\ \hline
  	stopGame & Stop the game. \\ \hline
  	onDeviceReady & The device is ready and we can start the game. \\ \hline

	\end{tabular}
	\end{table}

	



\subsection*{AudioPlayer}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	mediaSuccess & Function for printing audio debug information. \\ \hline
	mediaError & Function for printing audio debug information. \\ \hline
	getMediaStatusString & Function for printing audio debug information. \\ \hline
	mediaStatus & Function for printing audio debug information. \\ \hline
	getMediaPath & Get the path to the sound file.  \\ \hline
	audioPlayer.init & Initialize the audio player's sound files. \\ \hline
	audioPlayer.loadSfx & Load a audio file. \\ \hline
	audioPlayer.playRandMoney & Play a random money sound effect. \\ \hline
	\end{tabular}
	\end{table}



\subsection*{ImageLibrary}
	
	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Variables & Description \\ \hline
	imagesLoaded & Number of images loaded. \\ \hline
	imagesToLoad & Number of images that has to be loaded. \\ \hline
	\end{tabular}
	\end{table}

	\begin{table}[H]
	\begin{tabular}{p{4cm} | p{8cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	imgLib.isAllImagesLoaded & Returns true if all images attempted to be loaded with the loadImage function is done loading. \\ \hline	
	imgLib.loadImage & Load and return an image object. \\ \hline	
	\end{tabular}
	\end{table}

\clearpage

\section{Other}

\subsection*{Utilities}

	\begin{table}[H]
	\begin{tabular}{p{6cm} | p{6cm} }
	\hline
	\rowcolor{gray}
	Functions & Description \\ \hline
	requestAnimFrame & \url{www.paulirish.com/2011/requestanimationframe-for-smart-animating/} \\ \hline
	getPhoneGapPath & Returns the path to phonegap, device independently. \\ \hline
	timeToString & Translate a time in seconds to a string. \\ \hline
	onBackButton & Called when the backbutton on the device is pressed. \\ \hline
	scrollToTop & Scroll to the top of the html page. \\ \hline
	calcGoal & Calculate a goal for the level. \\ \hline
	calcLevelSize & Calculat ethe size of the map. \\ \hline
	generateBuildingSpawnTime & Calculate time to the next building spawn. \\ \hline
	sqr & Returns the square of the input number. \\ \hline
	dist2 & Returns the square of the distance between two points. \\ \hline
	distToSegmentSquared & Returns the square of the distance from a point to a line segment. \\ \hline
	distToSegment &  Returns the distance to from a point to a line segment. \\ \hline

	\end{tabular}
	\end{table}

\clearpage

\subsection*{Constants}

	\begin{table}[H]
	\begin{tabular}{p{6cm} | p{6cm} }

	\hline
	\rowcolor{gray}
	Variables & Description \\ \hline
	GAME\_FPS & Game frame rate. \\ \hline
	DEBUG & Print debug to console. \\ \hline
	HUD\_HEIGHT & Height of the UI hud. \\ \hline
	BuildingTemplates & Buildings to place on the map. \\ \hline
	BUILDING\_WIDTH & Buidling dimensions. \\ \hline
	BUILDING\_REVENUE\_FREQ & How often buildings generate money \\ \hline
	BUILDING\_DURABILITY &  \\ \hline
	POWERPLANT\_COST & \\ \hline
	POWERPLANT\_MAX\_LEVEL & \\ \hline
	POWERPLANT\_POWER & \\ \hline
	UPGRADE\_COST & \\ \hline
	POWERLINE\_COST & \\ \hline
	POWERLINE\_WIDTH & \\ \hline
	GameState & \\ \hline
	PowerLineState & \\ \hline
	PLAYER\_MAX\_HP & \\ \hline
	PLAYER\_START\_MONEY & \\ \hline

	\end{tabular}
	\end{table}
